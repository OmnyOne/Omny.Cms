@namespace Omny.Cms.UiRepositories.Components
@inherits RepositorySelectorBase
@using Omny.Cms.UiRepositories.Models
@using Omny.Cms.UiRepositories.Services
@using MudBlazor

<div class="repository-selector">
@if (IsFreeVersion)
{
    if (currentRepository?.NeedsPrToMerge == false)
    {
        <MudButton Class="update-link" OnClick="Deploy" Disabled="@BuildWatcher.IsUpdating">Deploy</MudButton>
    }
    else if (currentRepository?.NeedsPrToMerge == true)
    {
        if (string.IsNullOrEmpty(DeploymentRequestUrl))
        {
            <MudButton Class="update-link" OnClick="RequestDeployment" Disabled="@BuildWatcher.IsUpdating">Request Deployment</MudButton>
        }
        else
        {
            <MudButton Class="update-link" Href="@DeploymentRequestUrl" Target="_blank">View Deployment Request</MudButton>
        }
    }
    if (currentRepository?.HasWorkflowDispatch == true)
    {
        <MudButton Class="update-link" OnClick="TriggerUpdate" Disabled="@BuildWatcher.IsUpdating">Update Preview</MudButton>
    }
    <MudSelect T="string" Value="selectedRepositoryId" ValueChanged="OnRepositoryChanged" Label="Site" Disabled="@BuildWatcher.IsUpdating">
        @if (repositories != null)
        {
            foreach (var repo in repositories)
            {
                <MudSelectItem Value="@GetRepositoryId(repo)">@repo.Name</MudSelectItem>
            }
        }
    </MudSelect>
    <MudButton Class="add-repo" OnClick="OpenAddRepositoryDialogAsync" Disabled="@BuildWatcher.IsUpdating">+</MudButton>
    @if (currentRepository?.PreviewUrl != null)
    {
        <MudButton Class="preview-link" Href="@currentRepository.PreviewUrl" Target="_blank">See Preview</MudButton>
    }
}
else
{
    if (currentRepository?.NeedsPrToMerge == false)
    {
        <MudButton Class="update-link" OnClick="Deploy" Disabled="@BuildWatcher.IsUpdating">Deploy</MudButton>
    }
    else if (currentRepository?.NeedsPrToMerge == true)
    {
        if (string.IsNullOrEmpty(DeploymentRequestUrl))
        {
            <MudButton Class="update-link" OnClick="RequestDeployment" Disabled="@BuildWatcher.IsUpdating">Request Deployment</MudButton>
        }
        else
        {
            <MudButton Class="update-link" Href="@DeploymentRequestUrl" Target="_blank">View Deployment Request</MudButton>
        }
    }
    if (currentRepository?.HasWorkflowDispatch == true)
    {
        <MudButton Class="update-link" OnClick="TriggerUpdate" Disabled="@BuildWatcher.IsUpdating">Update Preview</MudButton>
    }
    <MudSelect T="string" Value="selectedRepositoryId" ValueChanged="OnRepositoryChanged" Label="Site" Disabled="@BuildWatcher.IsUpdating">
        @if (repositories != null)
        {
            foreach (var repo in repositories)
            {
                <MudSelectItem Value="@GetRepositoryId(repo)">@repo.Name</MudSelectItem>
            }
        }
    </MudSelect>
    @if (currentRepository?.PreviewUrl != null)
    {
        <MudButton Class="preview-link" Href="@currentRepository.PreviewUrl" Target="_blank">See Preview</MudButton>
    }
}
</div>

<style>
    .repository-selector {
        display: flex;
        align-items: center;
        gap: 8px;
    }
</style>
